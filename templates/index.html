<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Perfect University</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    {% include 'partials/firebaseconfig.html' %}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }

        .button-text {
            font-size: 12px;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .nav-white {
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .glass-card {
            background: white !important;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
        }

        /* Enhanced card styling */
        .university-card {
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .university-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3),
                0 4px 6px -2px rgba(59, 130, 246, 0.1);
            transform: translateY(-4px);
        }

        /* Enhanced stats grid */
        .university-card .grid div {
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        /* Enhanced faculty tags */
        .university-card .bg-blue-50 {
            border: 1px solid #bfdbfe;
            box-shadow: 0 1px 2px rgba(59, 130, 246, 0.1);
        }

        /* Enhanced buttons */
        .university-card button {
            border: 1px solid transparent;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced badge container */
        .badge-container div {
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Image container enhancement */
        .university-card .relative {
            border-bottom: 1px solid #e5e7eb;
        }

        /* Bottom gradient enhancement */
        .gradient-overlay {
            background: linear-gradient(180deg,
                    rgba(0, 0, 0, 0) 0%,
                    rgba(0, 0, 0, 0.8) 100%);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Stat container enhancements */
        .bg-gray-50 {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
        }

        .chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            width: 90%;
            max-width: 800px;
            border-radius: 1rem;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border-radius: 0.5rem;
            background-color: #f9fafb;
        }

        .close-button {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }

        .badge-container>div>div {
            background-color: var(--tw-bg-opacity) !important;
        }

        /* Specific badge background colors */
        .bg-yellow-500 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(245, 158, 11, var(--tw-bg-opacity)) !important;
        }

        .bg-blue-500 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(37, 99, 235, var(--tw-bg-opacity)) !important;
        }

        .bg-gray-400 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(156, 163, 175, var(--tw-bg-opacity)) !important;
        }

        .bg-orange-500 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(249, 115, 22, var(--tw-bg-opacity)) !important;
        }

        .bg-blue-600 {
            background-color: rgba(37, 99, 235, var(--tw-bg-opacity)) !important;
        }

        .bg-indigo-500 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(99, 102, 241, var(--tw-bg-opacity)) !important;
        }

        .bg-green-500 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(34, 197, 94, var(--tw-bg-opacity)) !important;
        }

        .bg-purple-600 {
            --tw-bg-opacity: .66 !important;
            background-color: rgba(147, 51, 234, var(--tw-bg-opacity)) !important;
        }

        /* Remove any backdrop blur */
        .backdrop-blur-sm {
            backdrop-filter: none !important;
        }

        /* Ensure text is always visible */
        .badge-container .text-white {
            color: white !important;
            opacity: 70;
        }

        .university-card {
            transform: translateZ(0);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }

        .university-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15);
        }

        .badge-container {
            position: relative;
        }

        .badge-container:hover .group-hover\:block {
            display: block;
            animation: fadeInTooltip 0.2s ease-out;
        }

        @keyframes fadeInTooltip {
            from {
                opacity: 0;
                transform: translateX(-4px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }



        /* Ensure consistent heights */
        .auto-rows-fr {
            grid-auto-rows: 1fr;
        }

        .badge-container {
            position: relative;
        }

        .badge-container:hover .group-hover\:block {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-4px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .university-card {
            animation: fadeIn 0.5s ease-out;
        }

        .badge-container span:hover {
            transform: translateY(-1px);
        }

        /* Badge color classes */
        .bg-rank-gold {
            background-color: #FFD700;
        }

        .bg-rank-silver {
            background-color: #C0C0C0;
        }

        .bg-rank-bronze {
            background-color: #CD7F32;
        }

        /* Gradient overlays */
        .gradient-overlay {
            background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.7) 100%);
        }

        /* Add these new styles */
        .badge-container {
            position: relative;
        }

        .badge-container:hover .group-hover\:block {
            display: block;
        }

        .animate-fade-in {
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Hover effect for badges */
        .badge-container span:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .group:hover .group-hover\:scale-110 {
            transform: scale(1.1);
        }

        .backdrop-blur {
            background-color: rgba(147, 51, 234, 0.5);
            backdrop-filter: blur(4px);
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .university-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .university-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .detail-modal,
        .chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            width: 90%;
            max-width: 1000px;
            border-radius: 1rem;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
        }

        .details-loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        .modal-loading {
            text-align: center;
            padding: 2rem;
        }

        .modal-loading p {
            color: #6b7280;
            margin-top: 0.5rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .nav-link {
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: width 0.2s ease-in-out;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .additionalCl {
            margin-top: 100px;
        }

        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        #uni_searcher {
            border: rgb(49, 49, 49) 2px solid;
            border-radius: 15px;
            outline: none;
            max-width: 170px;
            padding-left: 15px;
        }

        .relative {
            position: relative;
        }

        .absolute {
            position: absolute;
        }

        .top-1 {
            top: 50%;
        }

        .right-3 {
            right: 0.75rem;
        }

        .transform {
            transform: translateY(-50%);
        }

        .border-2 {
            border-width: 2px;
        }

        .border-gray-400 {
            --tw-border-opacity: 1;
            border-color: rgb(156 163 175 / var(--tw-border-opacity));
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .pr-8 {
            padding-right: 2rem;
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
        }

        .focus\:border-blue-500:focus {
            --tw-border-opacity: 1;
            border-color: rgb(59 130 246 / var(--tw-border-opacity));
        }

        .text-gray-400 {
            --tw-text-opacity: 1;
            color: rgb(156 163 175 / var(--tw-text-opacity));
        }
    </style>
</head>

<body class="bg-gray-50">
    {% include 'partials/navigation.html' %}

    <body class="bg-gray-50 min-h-screen">

        <body class="bg-gray-50">

            <div class="container mx-auto px-4 py-8 additionalCl">
                <h1 class="text-4xl font-bold text-center text-blue-600 mb-8">Find Your Perfect University</h1>

                <!-- Search Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <form id="searchForm" method="POST" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="country" class="block text-sm font-medium text-gray-700">Country or
                                    City</label>
                                <input type="text" name="country" id="country" required
                                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="faculty" class="block text-sm font-medium text-gray-700">Desired
                                    Faculty/Program</label>
                                <input type="text" name="faculty" id="faculty"
                                    placeholder="e.g., Computer Science, Medicine"
                                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="gpa" class="flex items-center block text-sm font-medium text-gray-700">GPA
                                    (optional)<a href=/gpa-calculator><button
                                            class="block text-sm font-bold text-blue-700 button-text"> Don't know your
                                            GPA?</a>
                                    </button></label>
                                <input type="number" step="0.01" min="0" max="4.0" name="gpa" id="gpa"
                                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="sat" class="block text-sm font-medium text-gray-700">SAT Score
                                    (optional)
                                    <input type="number" name="sat" id="sat"
                                        class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="budget" class="block text-sm font-medium text-gray-700">Budget
                                    (optional)</label>
                                <input type="text" name="budget" id="budget"
                                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="extra" class="block text-sm font-medium text-gray-700">Additional
                                    Requirements</label>
                                <input type="text" name="extra" id="extra"
                                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex justify-center space-x-4 pt-4">
                            <button type="submit"
                                class="bg-blue-600 text-white px-8 py-3 rounded-lg font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200">
                                Get Recommendations
                            </button>
                            <a href="/advisor"
                                class="bg-gray-100 text-gray-800 px-8 py-3 rounded-lg font-medium hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200">
                                Chat with Advisor
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Error Display -->
                {% if error %}
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-8 rounded-lg shadow-sm"
                    role="alert">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div>
                            <p class="font-bold">Error</p>
                            <p>{{ error }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Loading Spinner -->
                <div class="loader mx-auto my-8"></div>
                <!-- Update the container div structure -->
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <!-- Results Section with Wider Three Column Grid -->
                    <div class="max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8">
                        {% if recommendations and not error %}
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {% for uni in recommendations %}
                            <div
                                class="university-card bg-white rounded-lg shadow-lg overflow-hidden h-full flex flex-col">
                                <!-- Image and Badge Section -->
                                <div class="relative h-52">
                                    <img src="{{ uni.imageUrl }}" alt="{{ uni.universityName }}"
                                        class="w-full h-full object-cover">

                                    <!-- Single Badge -->
                                    <!-- Badge with Solid Background -->
                                    <div class="absolute top-3 left-3">
                                        {% for badge in uni.label[:1] %}
                                        <div class="badge-container group">
                                            <div class="{{badge.color_class}} flex items-center rounded-md"
                                                style="--bs-bg-opacity: .5;">
                                                <div
                                                    class="py-1.5 px-1.5 rounded-md text-sm font-medium shadow-md flex items-center gap-2 bg-transparent">
                                                    <span class="text-lg"> {{ badge.prefix }}</span>
                                                    <span class="font-semibold whitespace-nowrap">{{ badge.text
                                                        }}</span>
                                                </div>
                                            </div>

                                            <!-- Badge Tooltip -->
                                            <div
                                                class="hidden group-hover:block absolute left-full ml-3 top-0 w-72 p-3 bg-white rounded-lg shadow-xl z-30">
                                                <div class="relative">
                                                    <div
                                                        class="absolute w-2 h-2 bg-white transform rotate-45 -left-1 top-3">
                                                    </div>
                                                    <h4 class="font-bold text-gray-900 mb-1">{{ badge.field }}</h4>
                                                    <p class="text-sm text-gray-600">{{ badge.details }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>


                                    <!-- University Name Overlay -->
                                    <div
                                        class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/70 to-transparent px-5 py-4">
                                        <h3 class="text-xl font-bold text-white mb-2">{{ uni.universityName }}</h3>
                                        <div class="flex items-center text-gray-200">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                            </svg>
                                            <span>{{ uni.location }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Content Section -->
                                <div class="p-5 flex-grow flex flex-col">
                                    <!-- Stats Grid -->
                                    <div class="grid grid-cols-2 gap-4 mb-6">
                                        {% for stat in [
                                        {'label': 'Annual Tuition', 'value': uni.tuition},
                                        {'label': 'Acceptance Rate', 'value': uni.acceptanceRate},
                                        {'label': 'Required GPA', 'value': uni.GPA},
                                        {'label': 'Program Strength', 'value': uni.facultyStrengths.split(',')[0]}
                                        ] %}
                                        <div class="bg-gray-50 p-3 rounded-lg">
                                            <p class="text-xs text-gray-500 mb-1">{{ stat.label }}</p>
                                            <p class="font-semibold text-gray-900">{{ stat.value }}</p>
                                        </div>
                                        {% endfor %}
                                    </div>

                                    <!-- Faculty Tags -->
                                    <div class="mb-6">
                                        <h4 class="text-sm font-medium text-gray-500 mb-2">Faculty Strengths</h4>
                                        <div class="flex flex-wrap gap-2">
                                            {% for strength in uni.facultyStrengths.split(',')[:3] %}
                                            <span class="bg-blue-50 text-blue-700 text-sm px-3 py-1 rounded-full">
                                                {{ strength.strip() }}
                                            </span>
                                            {% endfor %}
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="flex gap-3 mt-auto">
                                        <button
                                            onclick="getUniversityDetails('{{ uni.universityName }}', '{{ country }}')"
                                            class="flex-1 flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            View Details
                                        </button>
                                        <button onclick="openChat('{{ uni.universityName }}', '{{ country }}')"
                                            class="flex-1 flex items-center justify-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                            </svg>
                                            Chat
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>


                    <!-- University Details Modal -->
                    <div id="detailModal" class="detail-modal">
                        <div class="modal-content">
                            <span class="close-button">&times;</span>
                            <div id="modalContent">
                                <h2 class="text-2xl font-bold text-blue-600 mb-4"></h2>
                                <!-- Add this loading section -->
                                <div id="modalLoading" class="modal-loading">
                                    <div class="details-loader"></div>
                                    <p>Loading university details...</p>
                                </div>
                                <!-- Content section -->
                                <div id="modalDetails" class="space-y-4" style="display: none;">
                                    <div id="description" class="text-gray-700"></div>
                                    <div id="notablePrograms" class="text-gray-700"></div>
                                    <div id="campusLife" class="text-gray-700"></div>
                                    <div id="admissionRequirements" class="text-gray-700"></div>
                                    <div id="researchOpportunities" class="text-gray-700"></div>
                                    <div id="ranking" class="text-gray-700"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Modal -->
                    <div id="chatModal" class="chat-modal">
                        <div class="modal-content">
                            <span class="close-button" onclick="closeChat()">&times;</span>
                            <div id="chatContent">
                                <h2 class="text-2xl font-bold text-blue-600 mb-4"></h2>
                                <div class="chat-messages p-4" id="chatMessages">
                                    <!-- Messages will be inserted here -->
                                </div>
                                <div class="flex gap-2 mt-4 p-4 border-t">
                                    <input type="text" id="chatInput"
                                        class="flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="Type your message...">
                                    <button onclick="sendMessage()"
                                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                        Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <script>
                        // Show loading spinner during form submission
                        document.getElementById('searchForm').onsubmit = () => {
                            document.querySelector('.loader').style.display = 'block';
                        };

                        // Modal functionality
                        const detailModal = document.getElementById('detailModal');
                        const chatModal = document.getElementById('chatModal');
                        const closeBtns = document.querySelectorAll('.close-button');

                        closeBtns.forEach(btn => {
                            btn.onclick = function () {
                                detailModal.style.display = 'none';
                                chatModal.style.display = 'none';
                            }
                        });

                        // In your getUniversityDetails function
                        function getUniversityDetails(universityName, country) {
                            const modal = document.getElementById('detailModal');
                            const loading = document.getElementById('modalLoading');
                            const details = document.getElementById('modalDetails');
                            const modalTitle = document.querySelector('#modalContent h2');

                            modalTitle.textContent = universityName;
                            loading.style.display = 'block';
                            details.style.display = 'none';
                            modal.style.display = 'block';

                            const formData = new FormData();
                            formData.append('university_name', universityName);
                            formData.append('country', country);

                            fetch('/university_details', {
                                method: 'POST',
                                body: formData
                            })
                                .then(response => response.json())
                                .then(data => {
                                    // Update modal content
                                    document.querySelector('#description').innerHTML =
                                        `<strong>Description:</strong><br>${data.description}`;
                                    document.querySelector('#notablePrograms').innerHTML =
                                        `<strong>Notable Programs:</strong><br>${data.notablePrograms}`;
                                    document.querySelector('#campusLife').innerHTML =
                                        `<strong>Campus Life:</strong><br>${data.campusLife}`;
                                    document.querySelector('#admissionRequirements').innerHTML =
                                        `<strong>Admission Requirements:</strong><br>${data.admissionRequirements.text}`;
                                    document.querySelector('#researchOpportunities').innerHTML =
                                        `<strong>Research Opportunities:</strong><br>${data.researchOpportunities}`;
                                    document.querySelector('#ranking').innerHTML =
                                        `<strong>Ranking:</strong><br>${data.ranking}`;

                                    // If there's an error, show it at the top of the modal
                                    if (data.error) {
                                        const errorDiv = document.createElement('div');
                                        errorDiv.className = 'bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4 rounded';
                                        errorDiv.innerHTML = `
                <p class="font-bold">Note</p>
                <p>Some information may be incomplete or unavailable at this time.</p>
            `;
                                        details.insertBefore(errorDiv, details.firstChild);
                                    }

                                    loading.style.display = 'none';
                                    details.style.display = 'block';
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    loading.style.display = 'none';
                                    details.style.display = 'block';
                                    details.innerHTML = `
            <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded">
                <p class="font-bold">Error</p>
                <p>Failed to fetch university details. Please try again later.</p>
            </div>
        `;
                                });
                        }

                        // Chat functionality
                        function closeChat() {
                            document.getElementById('chatModal').style.display = 'none';
                        }

                        function openChat(universityName, country) {
                            // Get modal and messages div
                            const modal = document.getElementById('chatModal');
                            const messages = document.getElementById('chatMessages');

                            // Clear previous messages
                            messages.innerHTML = '';

                            // Set university name in modal title
                            document.querySelector('#chatContent h2').textContent = `Chat about ${universityName}`;

                            // Add welcome message
                            addMessage(`Hi! I can help you learn more about ${universityName}. What would you like to know?`, 'bot');

                            // Show modal
                            modal.style.display = 'block';

                            // Focus on input
                            document.getElementById('chatInput').focus();
                        }

                        function addMessage(text, sender, isHTML = false) {
                            const messagesDiv = document.getElementById('chatMessages');
                            const messageDiv = document.createElement('div');

                            // Add base classes without special characters
                            messageDiv.className = 'p-3 rounded-lg mb-2';

                            // Add styling based on sender
                            if (sender === 'user') {
                                messageDiv.classList.add('ml-auto');
                                messageDiv.style.backgroundColor = '#EBF8FF';  // light blue
                                messageDiv.style.maxWidth = '80%';
                            } else {
                                messageDiv.style.backgroundColor = '#F3F4F6';  // light gray
                                messageDiv.style.maxWidth = '80%';
                            }

                            // Add content
                            if (isHTML) {
                                messageDiv.innerHTML = text;
                            } else {
                                messageDiv.textContent = text;
                            }

                            // Add to chat and scroll
                            messagesDiv.appendChild(messageDiv);
                            messagesDiv.scrollTop = messagesDiv.scrollHeight;

                            return messageDiv;
                        }

                        // Replace your existing sendMessage function with this one
                        function sendMessage() {
                            const input = document.getElementById('chatInput');
                            const message = input.value.trim();

                            if (!message) return;

                            // Clear input and add user message
                            input.value = '';
                            addMessage(message, 'user');

                            // Get university name
                            const universityName = document.querySelector('#chatContent h2').textContent.replace('Chat about ', '');

                            // Show typing indicator
                            const typingIndicator = addMessage('Typing...', 'bot');

                            // Create form data
                            const formData = new FormData();
                            formData.append('message', message);
                            formData.append('university_name', universityName);

                            // Send request
                            fetch('/chat', {
                                method: 'POST',
                                body: formData
                            })
                                .then(response => response.json())
                                .then(data => {
                                    // Remove typing indicator
                                    typingIndicator.remove();

                                    if (data.error) {
                                        addMessage('Sorry, I encountered an error. Please try again.', 'bot');
                                    } else {
                                        const formattedResponse = data.response
                                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                            .replace(/\n/g, '<br>');
                                        addMessage(formattedResponse, 'bot', true);
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    typingIndicator.remove();
                                    addMessage('Sorry, I encountered an error. Please try again.', 'bot');
                                });
                        }
                        // Add event listeners when document loads
                        document.addEventListener('DOMContentLoaded', function () {
                            const chatInput = document.getElementById('chatInput');
                            if (chatInput) {
                                // Add debug logging for input
                                chatInput.addEventListener('input', (e) => {
                                    console.log('Input value:', e.target.value);
                                });

                                // Add Enter key handling
                                chatInput.addEventListener('keypress', function (e) {
                                    if (e.key === 'Enter' && !e.shiftKey) {
                                        e.preventDefault();
                                        sendMessage();
                                    }
                                });
                            }

                            // Add button click handling
                            const sendButton = document.querySelector('button[onclick="sendMessage()"]');
                            if (sendButton) {
                                sendButton.addEventListener('click', function (e) {
                                    e.preventDefault();
                                    sendMessage();
                                });
                            }

                            // Close modal when clicking outside
                            const chatModal = document.getElementById('chatModal');
                            if (chatModal) {
                                chatModal.addEventListener('click', function (event) {
                                    if (event.target === chatModal) {
                                        closeChat();
                                    }
                                });
                            }
                        });

                        // Log form submission helper function
                        function logFormData(formData) {
                            for (let pair of formData.entries()) {
                                console.log(pair[0] + ': ' + pair[1]);
                            }
                        }
                        function toggleMobileMenu() {
                            const mobileMenu = document.getElementById('mobileMenu');
                            const menuIcon = document.getElementById('menuIcon');

                            if (mobileMenu.classList.contains('hidden')) {
                                mobileMenu.classList.remove('hidden');
                                menuIcon.setAttribute('d', 'M6 18L18 6M6 6l12 12'); // X icon
                            } else {
                                mobileMenu.classList.add('hidden');
                                menuIcon.setAttribute('d', 'M4 6h16M4 12h16M4 18h16'); // Hamburger icon
                            }
                        }

                        // Close mobile menu when window is resized to desktop view
                        window.addEventListener('resize', () => {
                            if (window.innerWidth >= 768) { // 768px is the md breakpoint in Tailwind
                                const mobileMenu = document.getElementById('mobileMenu');
                                const menuIcon = document.getElementById('menuIcon');
                                mobileMenu.classList.add('hidden');
                                menuIcon.setAttribute('d', 'M4 6h16M4 12h16M4 18h16');
                            }
                        });


                        document.addEventListener('DOMContentLoaded', function() {
                            const searchInput = document.getElementById('uni_searcher');
                            const searchIcon = searchInput.nextElementSibling;

                            function performSearch() {
                                const universityName = searchInput.value.trim();
                                if (!universityName) return;

                                const formData = new FormData();
                                formData.append('university_name', universityName);
                                formData.append('country', 'global');

                                fetch('/search_university', {
                                    method: 'POST',
                                    headers: {
                                        'X-Requested-With': 'XMLHttpRequest'
                                    },
                                    body: formData
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.error) {
                                        console.error('Error:', data.error);
                                        alert('Could not find university. Please try another search.');
                                        return;
                                    }
                                    
                                    const modalHtml = `
                                        <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start z-50 p-4 overflow-y-auto" id="searchModal">
                                            <div class="bg-white rounded-lg max-w-2xl w-full mt-20 mx-auto relative">
                                                <!-- Header - fixed at top -->
                                                <div class="sticky top-0 bg-white p-6 border-b border-gray-200 rounded-t-lg">
                                                    <div class="flex justify-between items-center">
                                                        <h2 class="text-2xl font-bold text-gray-900">${data.universityName || 'University Details'}</h2>
                                                        <button class="text-gray-500 hover:text-gray-700 transition-colors" id="closeSearchModal">
                                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Scrollable content -->
                                                <div class="p-6 overflow-y-auto" style="max-height: calc(80vh - 100px);">
                                                    ${data.imageUrl ? `
                                                        <div class="mb-6">
                                                            <img src="${data.imageUrl}" alt="${data.universityName}" 
                                                                class="w-full h-48 object-cover rounded-lg shadow-md">
                                                        </div>
                                                    ` : ''}

                                                    <div class="space-y-6">
                                                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                                                            <h3 class="text-lg font-semibold text-blue-600 mb-2">Description</h3>
                                                            <p class="text-gray-700 leading-relaxed">${data.description || 'No description available'}</p>
                                                        </div>

                                                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                                                            <h3 class="text-lg font-semibold text-blue-600 mb-2">Notable Programs</h3>
                                                            <p class="text-gray-700 leading-relaxed">${data.notablePrograms || 'Information not available'}</p>
                                                        </div>

                                                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                                                            <h3 class="text-lg font-semibold text-blue-600 mb-2">Campus Life</h3>
                                                            <p class="text-gray-700 leading-relaxed">${data.campusLife || 'Information not available'}</p>
                                                        </div>

                                                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                                                            <h3 class="text-lg font-semibold text-blue-600 mb-2">Admission Requirements</h3>
                                                            <div class="space-y-3">
                                                                <div>
                                                                    <h4 class="font-medium text-gray-800">General Requirements</h4>
                                                                    <p class="text-gray-700 leading-relaxed">
                                                                        ${data.admissionRequirements.general || 'Information not available'}
                                                                    </p>
                                                                </div>
                                                                <div>
                                                                    <h4 class="font-medium text-gray-800">GPA Requirement</h4>
                                                                    <p class="text-gray-700">
                                                                        ${data.admissionRequirements.gpa || 'Information not available'}
                                                                    </p>
                                                                </div>
                                                                <div>
                                                                    <h4 class="font-medium text-gray-800">English Language Requirements</h4>
                                                                    <p class="text-gray-700">
                                                                        IELTS: ${data.admissionRequirements.englishRequirements.ielts || 'Information not available'}
                                                                    </p>
                                                                    <p class="text-gray-700 text-sm mt-1">
                                                                        ${data.admissionRequirements.englishRequirements.notes || ''}
                                                                    </p>
                                                                </div>
                                                                <div>
                                                                    <h4 class="font-medium text-gray-800">Required Documents</h4>
                                                                    <p class="text-gray-700">
                                                                        ${data.admissionRequirements.documents || 'Information not available'}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                                                            <h3 class="text-lg font-semibold text-blue-600 mb-2">Research Opportunities</h3>
                                                            <p class="text-gray-700 leading-relaxed">${data.researchOpportunities || 'Information not available'}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;

                                    // Remove existing modal if it exists
                                    const existingModal = document.getElementById('searchModal');
                                    if (existingModal) {
                                        existingModal.remove();
                                    }

                                    // Add new modal
                                    document.body.insertAdjacentHTML('beforeend', modalHtml);

                                    // Add scroll styling
                                    document.body.style.overflow = 'hidden';

                                    // Add event listeners
                                    const modal = document.getElementById('searchModal');
                                    const closeButton = document.getElementById('closeSearchModal');

                                    function closeModal() {
                                        modal.remove();
                                        document.body.style.overflow = '';
                                    }

                                    closeButton.addEventListener('click', closeModal);
                                    modal.addEventListener('click', (e) => {
                                        if (e.target === modal) {
                                            closeModal();
                                        }
                                    });

                                    // Prevent closing when clicking inside modal content
                                    modal.querySelector('.bg-white').addEventListener('click', (e) => {
                                        e.stopPropagation();
                                    });
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    alert('Error searching for university. Please try again.');
                                });
                            }

                            // Add event listeners
                            searchIcon.addEventListener('click', performSearch);
                            searchInput.addEventListener('keypress', (e) => {
                                if (e.key === 'Enter') {
                                    performSearch();
                                }
                            });
                        });
                    </script>
        </body>

</html>